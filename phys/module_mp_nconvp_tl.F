
! ======================================================================================
! This file was generated by the version 5.3.7 of DFT on 12/08/2009. The differentiation
! transforming system(DFT) was jointly developed and sponsored by LASG of IAP(1998-2010)
! and LSEC of ICMSEC, AMSS(2001-2003)
! The copyright of the DFT system was declared by Walls at LASG, 1998-2010
! ======================================================================================

 MODULE g_module_mp_nconvp

 CONTAINS

!        Generated by TAPENADE     (INRIA, Tropics team)
!  Tapenade 3.5 (r3678) - 11 Feb 2011 13:58
!
!  Differentiation of lscond in forward (tangent) mode:
!   variations   of useful results: th qv rainnc rainncv
!   with respect to varying inputs: th p qv rainnc rainncv rho
!                pii dz8w
!   RW status of diff variables: th:in-out p:in qv:in-out rainnc:in-out
!                rainncv:in-out rho:in pii:in dz8w:in
! domain dims
! memory dims
! tile   dims
SUBROUTINE G_LSCOND(th, g_th, p, g_p, qv, g_qv, rho, g_rho, pii, g_pii, r_v, &
   xlv, cp, ep2, svp1, svp2, svp3, svpt0, dz8w, g_dz8w, rainnc, g_rainnc, &
   rainncv, g_rainncv, ids, ide, jds, jde, kds, kde, ims, ime, jms, jme, &
   kms, kme, its, ite, jts, jte, kts, kte)
  IMPLICIT NONE
!----------------------------------------------------------------
!  based on MM5 code (JD November 2006)
!----------------------------------------------------------------
  INTEGER, INTENT(IN) :: ids, ide, jds, jde, kds, kde, ims, ime, jms, &
   jme, kms, kme, its, ite, jts, jte, kts, kte
  REAL, INTENT(IN) :: r_v, xlv, cp
  REAL, INTENT(IN) :: ep2, svp1, svp2, svp3, svpt0
  REAL, DIMENSION(ims:ime, kms:kme, jms:jme), INTENT(INOUT) :: th, qv
  REAL, DIMENSION(ims:ime, kms:kme, jms:jme), INTENT(INOUT) :: g_th, g_qv
  REAL, DIMENSION(ims:ime, kms:kme, jms:jme), INTENT(IN) :: rho, pii, p&
   , dz8w
  REAL, DIMENSION(ims:ime, kms:kme, jms:jme), INTENT(IN) :: g_rho, g_pii, &
   g_p, g_dz8w
  REAL, DIMENSION(ims:ime, jms:jme), INTENT(INOUT) :: rainnc, rainncv
  REAL, DIMENSION(ims:ime, jms:jme), INTENT(INOUT) :: g_rainnc, g_rainncv
! local variables
  REAL :: ttemp, es1, qs1, dqv, cond, r1
  REAL :: ttempd, es1d, qs1d, g_dqv, condd, r1d
  INTEGER :: i, j, k
  REAL :: arg1
  REAL :: arg1d
  INTRINSIC EXP
!----------------------------------------------------------------
  DO j=jts,jte
    DO k=kts,kte
      DO i=its,ite
        ttempd = g_pii(i, k, j)*th(i, k, j) + pii(i, k, j)*g_th(i, k, j)
        ttemp = pii(i, k, j)*th(i, k, j)
        arg1d = (svp2*ttempd*(ttemp-svp3)-svp2*(ttemp-svpt0)*ttempd)/(&
           ttemp-svp3)**2
        arg1 = svp2*(ttemp-svpt0)/(ttemp-svp3)
        es1d = 1000.*svp1*arg1d*EXP(arg1)
        es1 = 1000.*svp1*EXP(arg1)
        qs1d = (ep2*es1d*(p(i, k, j)-es1)-ep2*es1*(g_p(i, k, j)-es1d))/(p&
           (i, k, j)-es1)**2
        qs1 = ep2*es1/(p(i, k, j)-es1)
        g_dqv = g_qv(i, k, j) - qs1d
        dqv = qv(i, k, j) - qs1
        IF (dqv .GT. 0.0) THEN
          r1d = (xlv**2*qs1d*ttemp**2/(r_v*cp)-xlv**2*qs1*(ttempd*ttemp+&
             ttemp*ttempd)/(r_v*cp))/(ttemp*ttemp)**2
          r1 = 1. + xlv*xlv/(r_v*cp)*qs1/(ttemp*ttemp)
          condd = (g_dqv*r1-dqv*r1d)/r1**2
          cond = dqv/r1
          g_qv(i, k, j) = g_qv(i, k, j) - condd
          qv(i, k, j) = qv(i, k, j) - cond
          ttempd = ttempd + xlv*condd/cp
          ttemp = ttemp + xlv/cp*cond
          g_th(i, k, j) = (ttempd*pii(i, k, j)-ttemp*g_pii(i, k, j))/pii(i&
             , k, j)**2
          th(i, k, j) = ttemp/pii(i, k, j)
          g_rainncv(i, j) = (g_rho(i, k, j)*cond+rho(i, k, j)*condd)*dz8w(&
             i, k, j) + rho(i, k, j)*cond*g_dz8w(i, k, j)
          rainncv(i, j) = rho(i, k, j)*cond*dz8w(i, k, j)
          g_rainnc(i, j) = g_rainnc(i, j) + (g_rho(i, k, j)*cond+rho(i, k, &
             j)*condd)*dz8w(i, k, j) + rho(i, k, j)*cond*g_dz8w(i, k, j)
          rainnc(i, j) = rainnc(i, j) + rho(i, k, j)*cond*dz8w(i, k, j)
        END IF
      END DO
    END DO
  END DO
  RETURN
END SUBROUTINE G_LSCOND

 END MODULE g_module_mp_nconvp

