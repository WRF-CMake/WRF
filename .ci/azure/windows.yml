steps:
- pwsh:
    Get-WmiObject Win32_Processor | Select-Object -Property [a-z]*
    Get-WmiObject Win32_OperatingSystem | Select-Object -Property [a-z]*
    Get-WmiObject Win32_LogicalDisk
  displayName: Dump VM specs

- script: set
  displayName: Dump environment variables

# We will install the latest version later on.
- pwsh: |
    $products = Get-CimInstance -ClassName Win32_Product -Filter "Name like 'Microsoft MPI%'"
    foreach ($p in $products) {
      echo "Uninstalling $($p.Name)"
      Invoke-CimMethod -InputObject $p -MethodName Uninstall
    }
  displayName: Remove existing MSMPI

- script: |
    choco install msys2 --params "/InstallDir:c:\msys64" --limit-output
  displayName: Install MSYS2

- task: BatchScript@1
  displayName: Setup dependencies
  inputs:
    filename: .ci\appveyor\setup-dependencies.bat
    modifyEnvironment: true

- task: BatchScript@1
  displayName: Install WRF
  inputs:
    filename: .ci\appveyor\install-wrf.bat

- task: PublishPipelineArtifact@0
  displayName: Publish binaries
  inputs:
    artifactName: binaries
    targetPath: build/install
